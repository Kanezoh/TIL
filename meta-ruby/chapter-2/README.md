# 第2章　オブジェクトモデル

## 2.1 オープンクラス

例えば、こんなコードがあるとする。  
~~~
def to_alphanumeric(s)
  s.gsub(/[^\w\s]/,'')
end
~~~

これは文字列から全ての句読点や特殊文字を排除、アルファベットとスペースのみにするメソッド。  
全ての文字列で共通して使える距離ならStringクラスをオープンして、そのメソッドとして追加する方が良い。  

~~~
class String
  def to_alphanumeric
     gsub(/[^\w\s]/,'')
  end
end
~~~  

Rubyではクラス定義のコードと他のコードに違いはないため、クラス定義の中に好きなコードを配置できる。  
~~~
3.times do
  class A
    puts 'ababa'
  end
end
=> ababa
   ababa
   ababa
~~~  

この場合、クラスが3回作成されているわけではない。1回目にクラスが作成され、それ以降はクラスを再オープンしてコードを実行している。  
Rubyにおけるclassはスコープ演算子のようなもの。存在しないクラスは作成、存在すれば再オープンしてとにかくそのクラスのコンテキストに連れて行ってくれる。  
だから既存のクラスにメソッドを追加したければ再オープンして定義すれば良いだけ、この手法を *オープンクラス* という。  

### 問題点

既存のクラスにメソッドを追加するときは注意が必要、例えばreplaceという名前のArrayクラスのメソッドがある。  
これを知らずに空の要素を削除するメソッドをreplaceというメソッドで追加したりすると...  
~~~
class Array
  def replace
    select{|e| e.empty?}
  end
end

arr = ['a','b','']
p arr.replace => ['a','b'] 
~~~  

なんと、標準メソッドをオーバーライドしていると警告が出ない。  
このように、オープンクラスだからと言って考えなしにメソッドを追加していては予期せぬバグを生んでしまう。  
このようなコードは *モンキーパッチ*(蔑称？）と呼ばれている。  


